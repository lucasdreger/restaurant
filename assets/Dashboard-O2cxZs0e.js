var fe=Object.defineProperty;var be=(s,t,r)=>t in s?fe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var E=(s,t,r)=>be(s,typeof t!="symbol"?t+"":t,r);import{j as e,c as y,u as L,g as je,a as ye,f as ve,t as $,b as re,i as de,s as me,C as ae,d as we,e as Ne,h as Ce,S as Se,M as _e}from"./index-DUOUId27.js";import{r as c}from"./vendor-state-CIiacWcF.js";import{T as P,h as U,i as J,j as ke,Z as ne,k as Te,l as he,m as H,a as D,n as Ie,o as Re,M as Me,L as Y,V as Z,R as z,p as G,X as ee,b as Ee,U as Ae,q as Oe,r as Pe,s as ie,D as Le,t as q,E as De}from"./vendor-ui-tYsHGQF9.js";import{B as ue}from"./Button-BmXsn4tF.js";import{F as Fe,u as xe,a as ge}from"./useVoiceRecognition-D60Zl_fG.js";import{F as Ve,g as $e,l as Ue}from"./fridgeService-CUhaz-Br.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-pdf-BScUNyKw.js";import"./vendor-supabase-CywEAasM.js";function Be({complianceStatus:s="ready",lastAudit:t="Today",autoLogging:r=!0,notificationCount:a=0,onNotificationsClick:o}){const d={ready:{gradient:"gradient-success",bgLight:"bg-green-500/10",text:"text-green-500",icon:J,label:"INSPECTION READY",sublabel:"FSAI ALIGNED"},warning:{gradient:"gradient-warning",bgLight:"bg-amber-500/10",text:"text-amber-500",icon:U,label:"ATTENTION NEEDED",sublabel:"REVIEW REQUIRED"},critical:{gradient:"gradient-danger",bgLight:"bg-red-500/10",text:"text-red-500",icon:P,label:"ACTION REQUIRED",sublabel:"NON-COMPLIANT"}}[s],h=d.icon;return e.jsxs("header",{className:"bg-glass-heavy border-b border-glass px-4 lg:px-6 py-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:y("flex items-center gap-3 px-4 py-3 rounded-xl",d.bgLight),children:[e.jsx("div",{className:y("p-2 rounded-lg",d.gradient),children:e.jsx(ke,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:y("w-4 h-4",d.text)}),e.jsx("p",{className:y("text-sm font-bold",d.text),children:d.label})]}),e.jsxs("p",{className:"text-xs text-theme-muted",children:[d.sublabel," ‚Ä¢ Last Audit: ",t]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[r&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-theme-card rounded-xl border border-theme-primary shadow-theme-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"w-4 h-4 text-green-500"}),e.jsx("div",{className:"absolute inset-0 animate-ping",children:e.jsx(ne,{className:"w-4 h-4 text-green-500 opacity-50"})})]}),e.jsx("span",{className:"text-xs font-semibold text-theme-primary",children:"AUTO-LOGGING"})]}),e.jsxs("button",{onClick:o,className:"relative p-2.5 rounded-xl bg-theme-card border border-theme-primary hover:shadow-theme-md transition-all",title:"View notifications",children:[e.jsx(Te,{className:"w-5 h-5 text-theme-secondary"}),a>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 gradient-danger rounded-full text-[10px] text-white font-bold flex items-center justify-center shadow-lg animate-pulse",children:a>9?"9+":a})]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-theme-primary to-theme-secondary",children:"Kitchen Command Center"}),e.jsx("p",{className:"text-sm text-theme-muted",children:"Real-time cooling compliance monitoring"})]}),e.jsx("div",{className:"flex-1 max-w-md ml-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-theme-muted pointer-events-none z-10"}),e.jsx("input",{type:"text",placeholder:"Search records, items, staff...",className:"input-stunning !pl-10"})]})})]}),e.jsxs("div",{className:"md:hidden mt-4",children:[e.jsx("h1",{className:"text-xl font-bold text-theme-primary",children:"Command Center"}),e.jsx("p",{className:"text-xs text-theme-muted",children:"Real-time cooling compliance"})]})]})}function Q({title:s,subtitle:t,value:r,maxValue:a=100,status:o,onClick:n}){const h={complete:{gradient:"gradient-success",bgLight:"bg-green-500/5",progressBg:"gradient-success",text:"text-green-500",icon:J},"in-progress":{gradient:"gradient-warning",bgLight:"bg-amber-500/5",progressBg:"gradient-warning",text:"text-amber-500",icon:U},pending:{gradient:"bg-theme-ghost",bgLight:"bg-theme-ghost",progressBg:"bg-theme-muted",text:"text-theme-muted",icon:U},warning:{gradient:"gradient-danger",bgLight:"bg-red-500/5",progressBg:"gradient-danger",text:"text-red-500",icon:P}}[o],j=typeof r=="number"?r/a*100:0,u=h.icon;return e.jsxs("button",{onClick:n,className:y("flex-1 min-w-[160px] p-4 rounded-xl text-left transition-all card-stunning","hover:shadow-theme-lg hover:-translate-y-0.5",h.bgLight),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-xs font-semibold text-theme-muted uppercase tracking-wide",children:s}),e.jsx(u,{className:y("w-4 h-4",h.text)})]}),e.jsxs("div",{className:"flex items-baseline gap-1 mb-3",children:[e.jsx("span",{className:y("text-3xl font-bold",h.text),children:r}),typeof r=="number"&&e.jsx("span",{className:y("text-lg font-semibold",h.text),children:"%"})]}),typeof r=="number"&&e.jsx("div",{className:"h-2 bg-theme-ghost rounded-full overflow-hidden",children:e.jsx("div",{className:y("h-full rounded-full transition-all duration-700",h.progressBg),style:{width:`${j}%`}})}),t&&e.jsx("p",{className:"text-xs text-theme-muted mt-2 truncate",children:t})]})}function oe({session:s,onClose:t,onDiscard:r}){const[a,o]=c.useState(""),[n,d]=c.useState(""),[h,j]=c.useState(0);c.useEffect(()=>{const S=()=>{const p=new Date,g=new Date(s.started_at),b=new Date(s.hard_due_at),C=p.getTime()-g.getTime(),w=Math.floor(C/(1e3*60)),i=Math.floor(w/60),l=w%60;i>0?d(`${i}h ${l}m`):d(`${l}m`);const f=b.getTime()-p.getTime();if(f<=0)o("OVERDUE");else{const N=Math.ceil(f/6e4);N>60?o(`${Math.floor(N/60)}h ${N%60}m`):o(`${N}m`)}const _=b.getTime()-g.getTime(),I=Math.min(100,C/_*100);j(I)};S();const m=setInterval(S,1e4);return()=>clearInterval(m)},[s]);const u=c.useMemo(()=>{switch(s.status){case"active":return{badge:"COOLING",badgeClass:"status-badge-active",cardClass:"cooling-card-active",iconGradient:"gradient-cool",progressGradient:"gradient-success",timerClass:"timer-safe",accent:"text-sky-500"};case"warning":return{badge:"WARNING",badgeClass:"status-badge-warning",cardClass:"cooling-card-warning",iconGradient:"gradient-warning",progressGradient:"gradient-warning",timerClass:"timer-warning",accent:"text-amber-500"};case"overdue":return{badge:"CRITICAL",badgeClass:"status-badge-danger",cardClass:"cooling-card-overdue",iconGradient:"gradient-danger",progressGradient:"gradient-danger",timerClass:"timer-danger",accent:"text-red-500"};default:return{badge:"COOLING",badgeClass:"status-badge-active",cardClass:"cooling-card",iconGradient:"bg-theme-ghost",progressGradient:"bg-theme-muted",timerClass:"",accent:"text-theme-muted"}}},[s.status]),v=()=>({sauce:"ü•Ñ",soup:"üç≤",meat:"ü•©",vegetable:"ü•ó",other:"üçΩÔ∏è"})[s.item_category]||"üçΩÔ∏è";return e.jsxs("div",{className:y("cooling-card",u.cardClass),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:y("w-14 h-14 rounded-xl flex items-center justify-center text-2xl shadow-lg",u.iconGradient),children:e.jsx("span",{className:"drop-shadow-md",children:v()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-theme-primary",children:s.item_name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-theme-muted",children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{children:"FSAI SC3 Cooling Protocol"})]})]})]}),e.jsxs("span",{className:y("status-badge",u.badgeClass),children:[s.status==="overdue"&&e.jsx(P,{className:"w-3 h-3"}),s.status==="warning"&&e.jsx(U,{className:"w-3 h-3"}),s.status==="active"&&e.jsx(D,{className:"w-3 h-3"}),u.badge]})]}),e.jsx("div",{className:"bg-theme-ghost rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-theme-muted uppercase tracking-wide mb-1",children:"Elapsed Time"}),e.jsx("span",{className:y("text-4xl font-mono font-bold tracking-tight",u.timerClass),children:n})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-theme-muted uppercase tracking-wide mb-1",children:"Remaining"}),e.jsx("span",{className:y("text-2xl font-mono font-bold",s.status==="overdue"?"text-red-500 animate-pulse":u.accent),children:a})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[e.jsx("span",{className:"text-theme-muted font-medium",children:"2-hour limit progress"}),e.jsxs("span",{className:y("font-bold",u.accent),children:[Math.round(h),"%"]})]}),e.jsx("div",{className:"h-3 bg-theme-ghost rounded-full overflow-hidden shadow-inner",children:e.jsx("div",{className:y("h-full rounded-full transition-all duration-700 shadow-lg",u.progressGradient),style:{width:`${Math.min(100,h)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-1 text-[10px] text-theme-muted",children:[e.jsx("span",{children:"Start"}),e.jsx("span",{className:"text-amber-500 font-medium",children:"90min"}),e.jsx("span",{className:"text-red-500 font-medium",children:"120min"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-theme-muted mb-4 p-3 bg-theme-ghost/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"w-3 h-3"}),e.jsx("span",{children:"Target: <8¬∞C"})]}),e.jsx("div",{className:"h-3 w-px bg-theme-primary"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{children:"Max: 2 hours"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>t(s.id),className:y("flex-1 flex items-center justify-center gap-2 px-4 py-3.5 rounded-xl font-bold transition-all","shadow-lg hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0",s.status==="overdue"?"gradient-warning text-white":"gradient-success text-white"),children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:"Move to Fridge"})]}),e.jsx("button",{onClick:()=>r(s.id),className:"px-4 py-3.5 rounded-xl bg-theme-ghost text-theme-muted hover:bg-red-500/20 hover:text-red-500 transition-all font-medium",title:"Discard item",children:e.jsx(Re,{className:"w-5 h-5"})})]})]})}class Ke{constructor(){E(this,"mediaRecorder",null);E(this,"audioChunks",[]);E(this,"stream",null)}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:16e3}}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:this.getSupportedMimeType()}),this.audioChunks=[],this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.audioChunks.push(t.data)},this.mediaRecorder.start(100),console.log("[Voice] Recording started")}catch(t){throw console.error("[Voice] Failed to start recording:",t),new Error("Microphone access denied or unavailable")}}async stop(){return new Promise((t,r)=>{if(!this.mediaRecorder){r(new Error("No recording in progress"));return}this.mediaRecorder.onstop=()=>{const a=new Blob(this.audioChunks,{type:this.getSupportedMimeType()});console.log("[Voice] Recording stopped, blob size:",a.size),this.stream&&(this.stream.getTracks().forEach(o=>o.stop()),this.stream=null),t(a)},this.mediaRecorder.stop()})}cancel(){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&this.mediaRecorder.stop(),this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.audioChunks=[]}get isRecording(){return this.mediaRecorder?.state==="recording"}getSupportedMimeType(){const t=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"];for(const r of t)if(MediaRecorder.isTypeSupported(r))return r;return"audio/webm"}}async function We(s){return new Promise((t,r)=>{const a=new FileReader;a.onloadend=()=>{const n=a.result.split(",")[1];t(n)},a.onerror=r,a.readAsDataURL(s)})}class Ge{constructor(t,r="en"){E(this,"apiKey");E(this,"language");this.apiKey=t,this.language=r}async transcribe(t){const r=new FormData,a=this.getExtensionFromMimeType(t.type),o=new File([t],`audio.${a}`,{type:t.type});r.append("file",o),r.append("model","whisper-1"),r.append("language",this.language),r.append("response_format","json"),console.log("[Whisper] Sending audio to OpenAI");try{const n=await fetch("https://api.openai.com/v1/audio/transcriptions",{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`},body:r});if(!n.ok){const h=await n.text();throw console.error("[Whisper] API error:",h),new Error(`Transcription failed: ${n.status}`)}const d=await n.json();return console.log("[Whisper] Transcription result:",d),{text:d.text||"",duration:d.duration}}catch(n){throw console.error("[Whisper] Transcription error:",n),n}}getExtensionFromMimeType(t){return t.includes("webm")?"webm":t.includes("mp4")?"m4a":t.includes("ogg")?"ogg":t.includes("wav")?"wav":"webm"}}class He{constructor(t,r="openai/gpt-audio-mini",a="en"){E(this,"apiKey");E(this,"model");E(this,"language");this.apiKey=t,this.model=r,this.language=a}async transcribe(t){const r=await We(t),a=t.type||"audio/webm";console.log("[OpenRouter] Sending audio to",this.model,"format:",this.getAudioFormat(a));const o={model:this.model,modalities:["text"],messages:[{role:"user",content:[{type:"input_audio",input_audio:{data:r,format:this.getAudioFormat(a)}},{type:"text",text:`Transcribe this audio exactly. Output only the transcription, nothing else. Language: ${this.language}`}]}]};try{const n=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"ChefKiosk Voice"},body:JSON.stringify(o)});if(!n.ok){const u=await n.text();throw console.error("[OpenRouter] API error:",n.status,u),new Error(`Transcription failed: ${n.status} - ${u}`)}const d=await n.json();console.log("[OpenRouter] Response:",d);const h=d.choices?.[0]?.message;let j="";return typeof h?.content=="string"?j=h.content:Array.isArray(h?.content)&&(j=h.content.find(v=>v.type==="text")?.text||""),{text:j.trim()}}catch(n){throw console.error("[OpenRouter] Transcription error:",n),n}}getAudioFormat(t){return t.includes("webm")?"webm":t.includes("mp4")||t.includes("m4a")?"mp4":t.includes("ogg")?"ogg":t.includes("wav")?"wav":t.includes("mp3")?"mp3":t.includes("flac")?"flac":"webm"}}class ze{constructor(){E(this,"recorder");E(this,"whisperClient",null);E(this,"openRouterClient",null);E(this,"activeProvider",null);E(this,"isInitialized",!1);this.recorder=new Ke}initialize(t){t.provider==="openai"?(this.whisperClient=new Ge(t.apiKey,t.language),this.activeProvider="openai",console.log("[Voice] Initialized with OpenAI Whisper")):t.provider==="openrouter"&&(this.openRouterClient=new He(t.apiKey,t.model||"openai/gpt-audio-mini",t.language),this.activeProvider="openrouter",console.log("[Voice] Initialized with OpenRouter",t.model)),this.isInitialized=!0}get isConfigured(){return this.isInitialized&&(this.whisperClient!==null||this.openRouterClient!==null)}get provider(){return this.activeProvider}get isRecording(){return this.recorder.isRecording}async startRecording(){if(!this.isConfigured)throw new Error("Voice service not configured. Please set API key in Settings.");await this.recorder.start()}async stopAndTranscribe(){const t=await this.recorder.stop();if(t.size<1e3)return console.log("[Voice] Audio too short, skipping transcription"),"";if(this.activeProvider==="openai"&&this.whisperClient)return(await this.whisperClient.transcribe(t)).text;if(this.activeProvider==="openrouter"&&this.openRouterClient)return(await this.openRouterClient.transcribe(t)).text;throw new Error("No voice provider configured")}cancelRecording(){this.recorder.cancel()}}const V=new ze;function qe(s){const t=s.toLowerCase().trim(),r=[/^(start|begin|new)\s*(cooling|cool)?\s*(.*)$/i,/^cool\s*(.*)$/i,/^cooling\s*(.*)$/i];for(const n of r){const d=t.match(n);if(d){const h=d[d.length-1]?.trim();return{type:"start_cooling",item:Fe.find(u=>u.name.toLowerCase().includes(h)||u.id.includes(h)||h.includes(u.name.toLowerCase()))?.name||h||void 0}}}const a=[/^(stop|done|close|finish|in\s*fridge|fridge)\s*(cooling)?/i,/^cooling\s*(done|finished|complete)/i];for(const n of a)if(n.test(t))return{type:"stop_cooling"};const o=[/^(discard|throw|bin|trash|waste)/i,/^(throw|toss)\s*(it)?\s*(away|out)?/i];for(const n of o)if(n.test(t))return{type:"discard"};return{type:"unknown"}}function pe(s={}){const{onCommand:t,onTranscript:r,onError:a}=s,[o,n]=c.useState(!1),[d,h]=c.useState(""),[j,u]=c.useState(null),[v,S]=c.useState(!1),m=c.useRef(!1),{isListening:p,setIsListening:g,settings:b}=L();c.useEffect(()=>{b.voiceProvider==="openai"&&b.openaiApiKey?(V.initialize({apiKey:b.openaiApiKey,provider:"openai",language:b.language||"en"}),n(!0),console.log("[WhisperHook] Initialized with OpenAI Whisper")):b.voiceProvider==="openrouter"&&b.openrouterApiKey?(V.initialize({apiKey:b.openrouterApiKey,provider:"openrouter",model:b.audioModel,language:b.language||"en"}),n(!0),console.log("[WhisperHook] Initialized with OpenRouter",b.audioModel)):n(!1)},[b.voiceProvider,b.openaiApiKey,b.openrouterApiKey,b.audioModel,b.language]);const C=c.useCallback(async()=>{if(!o){const f="Please configure OpenAI API key in Settings to use voice";u(f),a?.(f);return}if(!(p||m.current))try{h(""),u(null),m.current=!0,g(!0),await V.startRecording(),console.log("[WhisperHook] Recording started")}catch(f){const _=f instanceof Error?f.message:"Failed to start recording";console.error("[WhisperHook] Start error:",_),u(_),a?.(_),m.current=!1,g(!1)}},[o,p,g,a]),w=c.useCallback(async()=>{if(m.current)try{S(!0),m.current=!1;const f=await V.stopAndTranscribe();if(console.log("[WhisperHook] Transcription:",f),h(f),r?.(f),f){const _=qe(f);console.log("[WhisperHook] Parsed command:",_),t?.(_)}}catch(f){const _=f instanceof Error?f.message:"Transcription failed";console.error("[WhisperHook] Stop error:",_),u(_),a?.(_)}finally{S(!1),g(!1)}},[g,t,r,a]),i=c.useCallback(async()=>{p||m.current?await w():await C()},[p,C,w]),l=c.useCallback(()=>{V.cancelRecording(),m.current=!1,g(!1)},[g]);return{isSupported:!0,isConfigured:o,isListening:p,isProcessing:v,transcript:d,error:j,startListening:C,stopListening:w,toggleListening:i,cancelListening:l}}const Qe=c.forwardRef(function({onCommand:t,onEnd:r,className:a,size:o="lg",wakeWordActive:n=!1,wakeWordTriggered:d=!1,wakeWordLabel:h="Hey Luma"},j){const{speak:u}=xe(),{settings:v}=L(),S=v.voiceProvider==="openai"&&v.openaiApiKey||v.voiceProvider==="openrouter"&&v.openrouterApiKey,m=v.voiceProvider==="openai"?"OpenAI Whisper":v.voiceProvider==="openrouter"?`OpenRouter (${v.audioModel?.split("/")[1]||"gpt-audio-mini"})`:"Browser",p=c.useCallback(R=>{console.log("[VoiceButton] Command received:",R),R.type==="start_cooling"?u(`Starting cooling${R.item?` for ${R.item}`:""}`):R.type==="stop_cooling"?u("Cooling complete, moved to fridge"):R.type==="discard"?u("Item discarded"):u("Sorry, I didn't understand that"),t(R)},[t,u]),g=c.useCallback(()=>{console.log("[VoiceButton] Voice ended"),r?.()},[r]),b=ge({onCommand:p,onError:R=>{console.error("[BrowserVoice] Error:",R),g()}}),C=pe({onCommand:p,onError:R=>{console.error("[WhisperVoice] Error:",R),g()}}),w=S?C:b,{isSupported:i,isListening:l,transcript:f,error:_,toggleListening:I,startListening:N}=w,k=S?C.isProcessing:!1;c.useImperativeHandle(j,()=>({triggerVoice:()=>{console.log("[VoiceButton] Triggered via ref (wake word)"),!l&&!k&&(N?N():I())}}),[l,k,N,I]),c.useEffect(()=>{d&&!l&&!k&&(console.log("[VoiceButton] Wake word triggered - starting voice"),N?N():I())},[d,l,k,N,I]),c.useEffect(()=>{if(!l&&!k&&f){const R=setTimeout(()=>{g()},500);return()=>clearTimeout(R)}},[l,k,f,g]);const O={sm:"w-12 h-12",md:"w-20 h-20",lg:"w-28 h-28"},A={sm:"w-6 h-6",md:"w-10 h-10",lg:"w-14 h-14"};return!i&&!S?e.jsxs("div",{className:y("flex flex-col items-center justify-center gap-2 text-theme-muted",a),children:[e.jsx(Me,{className:A[o]}),o!=="sm"&&e.jsx("span",{className:"text-sm",children:"Voice not supported"})]}):o==="sm"?e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:I,disabled:k,className:y("voice-button rounded-full flex items-center justify-center transition-all duration-200",O[o],k?"bg-purple-500 shadow-lg shadow-purple-500/50":l?"voice-listening bg-green-500 shadow-lg shadow-green-500/50":n?"bg-gradient-to-b from-rose-600 to-rose-700 hover:from-rose-500 hover:to-rose-600 shadow-lg shadow-rose-500/30":"bg-purple-500 hover:bg-purple-600 shadow-lg shadow-purple-500/30","active:scale-95 disabled:opacity-50",a),"aria-label":l?"Stop listening":"Start voice command",children:k?e.jsx(Y,{className:y(A[o],"text-white animate-spin")}):l?e.jsx(Z,{className:y(A[o],"text-white animate-pulse")}):n?e.jsx(z,{className:y(A[o],"text-white animate-pulse")}):e.jsx(G,{className:y(A[o],"text-white")})}),n&&!l&&!k&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-rose-500 rounded-full animate-pulse"})]}):e.jsxs("div",{className:y("flex flex-col items-center gap-3",a),children:[n&&!l&&!k&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-rose-500/20 rounded-full border border-rose-500/30",children:[e.jsx(z,{className:"w-4 h-4 text-rose-400 animate-pulse"}),e.jsxs("span",{className:"text-xs text-rose-400 font-medium",children:['Say "',h,'"']})]}),e.jsx("button",{onClick:I,disabled:k,className:y("voice-button rounded-full flex items-center justify-center transition-all duration-200",O[o],k?"bg-purple-500 shadow-lg shadow-purple-500/50":l?"voice-listening bg-green-500 shadow-lg shadow-green-500/50":n?"bg-gradient-to-b from-rose-600 to-rose-700 hover:from-rose-500 hover:to-rose-600 shadow-lg shadow-rose-500/30 ring-2 ring-rose-500/50":"bg-purple-500 hover:bg-purple-600 shadow-lg shadow-purple-500/30","active:scale-95 disabled:opacity-70"),"aria-label":l?"Stop listening":"Start voice command",children:k?e.jsx(Y,{className:y(A[o],"text-white animate-spin")}):l?e.jsx(Z,{className:y(A[o],"text-white animate-pulse")}):n?e.jsx(z,{className:y(A[o],"text-white animate-pulse")}):e.jsx(G,{className:y(A[o],"text-white")})}),e.jsxs("div",{className:"text-center min-h-[60px]",children:[k&&e.jsx("p",{className:"text-purple-400 font-medium",children:"üîÑ Processing..."}),l&&!k&&e.jsx("p",{className:"text-green-400 font-medium animate-pulse",children:"üé§ Listening..."}),f&&!l&&!k&&e.jsxs("p",{className:"text-theme-muted text-sm max-w-[200px]",children:['Heard: "',f,'"']}),_&&!l&&!k&&e.jsx("div",{className:"text-amber-400 text-sm max-w-[220px]",children:e.jsxs("p",{children:["‚ö†Ô∏è ",_]})}),!l&&!f&&!_&&!k&&e.jsx("p",{className:"text-theme-muted text-sm",children:n?`Listening for "${h}"`:S?"Tap to record":"Tap to speak"})]}),e.jsxs("div",{className:"text-center text-xs text-theme-muted max-w-[250px]",children:[e.jsx("p",{className:"font-medium mb-1",children:"Say:"}),e.jsx("p",{children:'"Start cooling [item]"'}),e.jsx("p",{children:'"Done" or "In fridge"'}),e.jsx("p",{children:'"Discard"'}),S&&e.jsxs("p",{className:"mt-2 text-purple-400",children:["Using ",m]})]})]})});function Xe({onCommand:s,className:t}){const{settings:r}=L(),a=r.voiceProvider==="openai"&&r.openaiApiKey||r.voiceProvider==="openrouter"&&r.openrouterApiKey,o=ge({onCommand:s}),n=pe({onCommand:s}),d=a?n:o,{isSupported:h,isListening:j,toggleListening:u}=d,v=a?n.isProcessing:!1;return!h&&!a?null:e.jsx("button",{onClick:u,disabled:v,className:y("p-3 rounded-xl transition-all duration-200",v?"bg-purple-500 text-white shadow-lg shadow-purple-500/50":j?"bg-green-500 text-white shadow-lg shadow-green-500/50":"bg-theme-ghost text-theme-secondary hover:bg-theme-secondary","disabled:opacity-50",t),"aria-label":j?"Stop listening":"Start voice command",children:v?e.jsx(Y,{className:"w-6 h-6 animate-spin"}):j?e.jsx(Z,{className:"w-6 h-6 animate-pulse"}):e.jsx(G,{className:"w-6 h-6"})})}function Ye({isOpen:s,onClose:t,onStart:r}){const{foodPresets:a,incrementFoodUsage:o}=L(),[n,d]=c.useState(null),[h,j]=c.useState(""),[u,v]=c.useState(""),S=c.useMemo(()=>je(a),[a]),m=c.useMemo(()=>{let i=S;if(n&&(i=i.filter(l=>l.category===n)),u.trim()){const l=u.toLowerCase();i=i.filter(f=>f.name.toLowerCase().includes(l))}return!n&&!u.trim()&&(i=i.slice(0,12)),i},[S,n,u]);if(!s)return null;const p=[{id:"sauce",label:"Sauces",icon:"ü•´"},{id:"soup",label:"Soups",icon:"üç≤"},{id:"meat",label:"Meats",icon:"ü•©"},{id:"vegetable",label:"Veg",icon:"ü•ó"},{id:"other",label:"Other",icon:"üì¶"}],g=i=>{o(i.id),r(i.name,i.category),C()},b=()=>{h.trim()&&(r(h.trim(),n||"other"),C())},C=()=>{d(null),j(""),v(""),t()},w=i=>{if(i.type==="start_cooling"&&i.item){const l=a.find(f=>f.name.toLowerCase().includes(i.item.toLowerCase()));l?(o(l.id),r(l.name,l.category)):r(i.item,"other"),C()}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:C}),e.jsxs("div",{className:"relative w-full sm:max-w-2xl h-[95vh] sm:h-auto sm:max-h-[90vh] overflow-hidden bg-theme-modal rounded-t-3xl sm:rounded-3xl shadow-2xl animate-slide-in border border-theme-primary",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-theme-primary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-sky-500/20 rounded-xl",children:e.jsx(D,{className:"w-6 h-6 text-sky-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-theme-primary",children:"Start Cooling"}),e.jsx("p",{className:"text-xs text-theme-muted",children:"Select food item"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{onCommand:w}),e.jsx("button",{onClick:C,className:"p-3 hover:bg-theme-ghost rounded-xl transition-colors text-theme-primary",children:e.jsx(ee,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"px-4 py-3 border-b border-theme-primary",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-theme-muted pointer-events-none z-10"}),e.jsx("input",{type:"text",value:u,onChange:i=>v(i.target.value),placeholder:"Search food items...",className:"input-stunning !pl-11"})]})}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto p-3 border-b border-theme-primary scrollbar-hide",children:[e.jsx("button",{onClick:()=>d(null),className:y("flex-shrink-0 px-5 py-3 rounded-xl font-semibold transition-all min-w-[80px] text-center",n?"bg-theme-ghost text-theme-secondary hover:bg-theme-elevated active:scale-95":"bg-sky-500 text-white shadow-lg shadow-sky-500/30"),children:"Top Used"}),p.map(i=>e.jsxs("button",{onClick:()=>d(i.id),className:y("flex-shrink-0 px-5 py-3 rounded-xl font-semibold transition-all flex items-center gap-2 min-w-[80px] justify-center",n===i.id?"bg-sky-500 text-white shadow-lg shadow-sky-500/30":"bg-theme-ghost text-theme-secondary hover:bg-theme-elevated active:scale-95"),children:[e.jsx("span",{className:"text-lg",children:i.icon}),e.jsx("span",{className:"hidden sm:inline",children:i.label})]},i.id))]}),e.jsxs("div",{className:"p-4 overflow-y-auto flex-1",style:{maxHeight:"calc(95vh - 280px)"},children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 mb-4",children:m.map(i=>e.jsxs("button",{onClick:()=>g(i),className:"flex flex-col items-center justify-center gap-2 p-5 bg-theme-card hover:bg-theme-elevated border border-theme-primary rounded-2xl transition-all active:scale-95 min-h-[100px] touch-manipulation",children:[e.jsx("span",{className:"text-4xl",children:i.icon}),e.jsx("span",{className:"font-semibold text-center text-sm leading-tight text-theme-primary",children:i.name}),(i.use_count||0)>0&&e.jsxs("span",{className:"text-[10px] text-theme-muted",children:["Used ",i.use_count,"x"]})]},i.id))}),m.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-theme-secondary",children:"No items found"}),e.jsx("p",{className:"text-sm text-theme-muted mt-1",children:"Try a different search or add custom item"})]}),e.jsxs("div",{className:"border-t border-theme-primary pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-theme-muted"}),e.jsx("span",{className:"text-sm text-theme-muted",children:"Custom item:"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:i=>j(i.target.value),placeholder:"e.g., Mushroom risotto",className:"flex-1 px-4 py-4 bg-theme-input border border-theme-input rounded-xl text-theme-primary placeholder:text-theme-muted focus:outline-none focus:border-sky-500 text-lg",onKeyDown:i=>{i.key==="Enter"&&b()}}),e.jsx(ue,{variant:"cooling",size:"lg",onClick:b,disabled:!h.trim(),className:"px-6",children:"Start"})]})]})]}),e.jsx("div",{className:"p-4 border-t border-theme-primary bg-theme-secondary safe-area-bottom",children:e.jsx("p",{className:"text-center text-sm text-theme-secondary",children:"üí° Timer starts immediately ‚Ä¢ Move to fridge within 2 hours"})})]})]})}const Ze=[2,4,5,6,7,8];function Je({isOpen:s,onClose:t,onConfirm:r,session:a}){const{staffMembers:o}=L(),[n,d]=c.useState(void 0),[h,j]=c.useState(""),[u,v]=c.useState(null),[S,m]=c.useState(!1),p=c.useMemo(()=>o.filter(N=>N.active),[o]),g=c.useCallback(()=>{const N=S&&h?parseFloat(h):n;r({temperature:N,staffId:u?.id,staffName:u?.name}),d(void 0),j(""),v(null),m(!1)},[n,h,u,S,r]),b=c.useCallback(()=>{d(void 0),j(""),v(null),m(!1),t()},[t]);if(!s||!a)return null;const C=ye(new Date(a.started_at)),w=Math.floor(C/60),i=a.status==="overdue",l=a.status==="warning",f=S&&h?parseFloat(h):n,_=f!==void 0&&f<8,I=f!==void 0&&f>=8;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:b}),e.jsxs("div",{className:"relative w-full sm:max-w-lg bg-theme-card rounded-t-3xl sm:rounded-2xl shadow-2xl border border-theme-primary max-h-[95vh] overflow-y-auto animate-slide-in",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-theme-primary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-xl",children:e.jsx(D,{className:"w-6 h-6 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-theme-primary",children:"Move to Fridge"}),e.jsx("p",{className:"text-sm text-theme-muted",children:"FSAI SC3 - Cooling Record"})]})]}),e.jsx("button",{onClick:b,className:"p-3 hover:bg-theme-hover rounded-xl transition-colors",children:e.jsx(ee,{className:"w-6 h-6 text-theme-muted"})})]}),e.jsxs("div",{className:"p-4 space-y-5",children:[e.jsx("div",{className:y("p-4 rounded-xl border",i?"bg-red-500/10 border-red-500/30":l?"bg-amber-500/10 border-amber-500/30":"bg-theme-secondary border-theme-primary"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-theme-primary text-xl",children:a.item_name}),e.jsxs("p",{className:"text-sm text-theme-muted",children:["Cooling time: ",ve(C)," (",w,"m)"]})]}),i&&e.jsxs("div",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Overdue"})]}),l&&!i&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-400",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Warning"})]}),!i&&!l&&e.jsxs("div",{className:"flex items-center gap-1 text-emerald-400",children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"On time"})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-theme-secondary mb-3",children:[e.jsx(Ae,{className:"w-4 h-4 text-purple-400"}),"Who's recording?"]}),p.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.map(N=>e.jsxs("button",{onClick:()=>v(N),className:y("p-4 rounded-xl transition-all flex flex-col items-center justify-center gap-1 min-h-[80px] touch-manipulation",u?.id===N.id?"bg-purple-500 text-white ring-2 ring-purple-400":"bg-theme-secondary text-theme-secondary hover:bg-theme-hover active:scale-95"),children:[e.jsx("span",{className:"text-2xl font-bold",children:N.initials}),e.jsx("span",{className:"text-xs truncate max-w-full",children:N.name})]},N.id))}):e.jsxs("div",{className:"p-4 bg-theme-secondary rounded-xl text-center",children:[e.jsx("p",{className:"text-theme-muted text-sm mb-2",children:"No staff members configured"}),e.jsx("p",{className:"text-xs text-theme-muted",children:"Add staff in Settings ‚Üí Staff"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-theme-secondary mb-3",children:[e.jsx(H,{className:"w-4 h-4 text-sky-400"}),"Final Temperature (¬∞C)",e.jsx("span",{className:"text-theme-muted",children:"- should be <8¬∞C"})]}),S?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",value:h,onChange:N=>j(N.target.value),placeholder:"Enter temperature",className:y("w-full p-5 text-3xl font-mono text-center bg-theme-secondary text-theme-primary border rounded-xl focus:outline-none focus:ring-2 transition-all",h&&parseFloat(h)>=8?"border-amber-500 focus:ring-amber-500":"border-theme-primary focus:ring-sky-500"),autoFocus:!0}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-2xl text-theme-muted",children:"¬∞C"})]}),e.jsx("button",{onClick:()=>{m(!1),j("")},className:"w-full py-3 text-sm text-theme-muted hover:text-theme-secondary transition-colors bg-theme-secondary rounded-xl",children:"Use preset temperatures"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-6 gap-2 mb-3",children:Ze.map(N=>e.jsxs("button",{onClick:()=>d(N),className:y("py-5 rounded-xl text-xl font-bold transition-all touch-manipulation active:scale-95",n===N?N<8?"bg-emerald-500 text-white ring-2 ring-emerald-400":"bg-amber-500 text-white ring-2 ring-amber-400":"bg-theme-secondary text-theme-secondary hover:bg-theme-hover"),children:[N,"¬∞"]},N))}),e.jsx("button",{onClick:()=>m(!0),className:"w-full py-3 text-sm text-theme-muted hover:text-theme-secondary transition-colors bg-theme-secondary rounded-xl",children:"Enter custom temperature"})]}),I&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-500/10 border border-amber-500/30 rounded-xl flex items-start gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-amber-300",children:"Temperature is ‚â•8¬∞C. FSAI requires food to be cooled to <8¬∞C within 2 hours. Consider continuing to cool or document exception."})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-theme-primary space-y-3 safe-area-bottom",children:[e.jsxs(ue,{variant:"primary",size:"kiosk",fullWidth:!0,onClick:g,className:y("flex items-center justify-center gap-2 py-5",_&&"bg-emerald-600 hover:bg-emerald-500"),children:[e.jsx(D,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold text-lg",children:f!==void 0?`Confirm at ${f}¬∞C`:"Confirm Move to Fridge"})]}),f===void 0&&e.jsx("button",{onClick:g,className:"w-full py-3 text-sm text-theme-muted hover:text-theme-secondary transition-colors",children:"Skip temperature (not recommended)"})]})]})]})}function et({isOpen:s,onClose:t,onSuccess:r}){const{currentSite:a,settings:o,staffMembers:n}=L(),[d,h]=c.useState([]),[j,u]=c.useState(0),[v,S]=c.useState(""),[m,p]=c.useState(!1),[g,b]=c.useState(!1),C=Ve[o.subscriptionTier]||1;c.useEffect(()=>{s&&a?.id&&w()},[s,a?.id]);const w=async()=>{if(a?.id)try{const T=await $e(a.id);h(T.slice(0,C))}catch(T){console.error("Failed to load fridges:",T),h([{id:"demo-fridge-1",site_id:a.id,name:"Main Fridge",sort_order:0,min_temp:0,max_temp:5,active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}])}},i=d[j],l=v?parseFloat(v):null,f=l!==null&&l>=0&&l<=5,_=l!==null&&(l<0||l>5),I=c.useCallback(T=>{if(!(v.length>=4))if(T==="."){if(v.includes("."))return;S(x=>x+".")}else if(T==="-"){if(v.length>0)return;S("-")}else{if(v.includes(".")){const[,x]=v.split(".");if(x&&x.length>=1)return}S(x=>x+T)}},[v]),N=c.useCallback(()=>{S(T=>T.slice(0,-1))},[]),k=c.useCallback(()=>{S("")},[]),O=async()=>{if(!(!a?.id||!i||l===null)){p(!0);try{await Ue({site_id:a.id,fridge_id:i.id,temperature:l,recorded_by_name:n[0]?.name||void 0}),b(!0),$.success(`${i.name}: ${l}¬∞C logged`),d.length>1&&j<d.length-1?setTimeout(()=>{u(T=>T+1),S(""),b(!1)},800):setTimeout(()=>{b(!1),S(""),u(0),r?.(),t()},1e3)}catch(T){console.error("Failed to log temperature:",T),$.error("Failed to log temperature")}finally{p(!1)}}},A=()=>{j>0&&(u(T=>T-1),S(""))},R=()=>{j<d.length-1&&(u(T=>T+1),S(""))};return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"w-full max-w-md mx-4 bg-theme-card rounded-3xl shadow-2xl overflow-hidden border border-theme-primary",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-theme-primary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:y("p-2 rounded-xl",f?"bg-emerald-500/20 text-emerald-400":_?"bg-red-500/20 text-red-400":"bg-sky-500/20 text-sky-400"),children:e.jsx(H,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-theme-primary",children:"Log Fridge Temp"}),e.jsx("p",{className:"text-xs text-theme-muted",children:"FSAI SC1 Compliance"})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-theme-muted hover:text-theme-primary hover:bg-theme-ghost rounded-xl transition-colors",children:e.jsx(ee,{className:"w-6 h-6"})})]}),d.length>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-theme-secondary",children:[e.jsx("button",{onClick:A,disabled:j===0,className:"p-2 rounded-xl disabled:opacity-30 hover:bg-theme-ghost transition-colors",children:e.jsx(Oe,{className:"w-5 h-5 text-theme-secondary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-theme-primary",children:i?.name}),e.jsxs("p",{className:"text-xs text-theme-muted",children:[j+1," of ",d.length]})]}),e.jsx("button",{onClick:R,disabled:j===d.length-1,className:"p-2 rounded-xl disabled:opacity-30 hover:bg-theme-ghost transition-colors",children:e.jsx(Pe,{className:"w-5 h-5 text-theme-secondary"})})]}),d.length===1&&i&&e.jsx("div",{className:"px-4 py-3 bg-theme-secondary text-center",children:e.jsx("p",{className:"text-sm font-semibold text-theme-primary",children:i.name})}),e.jsxs("div",{className:"p-6 flex flex-col items-center",children:[e.jsx("div",{className:y("w-full py-6 px-4 rounded-2xl text-center transition-colors",g?"bg-emerald-500/20 border-2 border-emerald-500":_?"bg-red-500/10 border-2 border-red-500":f?"bg-emerald-500/10 border-2 border-emerald-500/50":"bg-theme-secondary border-2 border-theme-primary"),children:g?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ie,{className:"w-12 h-12 text-emerald-400"}),e.jsx("span",{className:"text-lg text-emerald-400 font-semibold",children:"Logged!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-5xl font-bold text-theme-primary font-mono min-h-[60px]",children:[v||e.jsx("span",{className:"text-theme-muted",children:"‚Äî"}),v&&e.jsx("span",{className:"text-3xl ml-1 text-theme-muted",children:"¬∞C"})]}),_&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3 text-red-400",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Out of range (0-5¬∞C)"})]}),f&&l!==null&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3 text-emerald-400",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Compliant"})]})]})}),e.jsx("div",{className:"mt-3 text-xs text-theme-muted text-center",children:"Target range: 0¬∞C to 5¬∞C"})]}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[["7","8","9","4","5","6","1","2","3"].map(T=>e.jsx("button",{onClick:()=>I(T),className:"h-16 text-2xl font-bold bg-theme-ghost hover:bg-theme-secondary active:bg-theme-input text-theme-primary rounded-xl transition-colors border border-theme-primary",children:T},T)),e.jsx("button",{onClick:()=>I("-"),className:"h-16 text-2xl font-bold bg-theme-ghost hover:bg-theme-secondary active:bg-theme-input text-theme-primary rounded-xl transition-colors border border-theme-primary",children:"‚àí"}),e.jsx("button",{onClick:()=>I("0"),className:"h-16 text-2xl font-bold bg-theme-ghost hover:bg-theme-secondary active:bg-theme-input text-theme-primary rounded-xl transition-colors border border-theme-primary",children:"0"}),e.jsx("button",{onClick:()=>I("."),className:"h-16 text-2xl font-bold bg-theme-ghost hover:bg-theme-secondary active:bg-theme-input text-theme-primary rounded-xl transition-colors border border-theme-primary",children:"."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("button",{onClick:k,className:"h-12 text-sm font-semibold bg-theme-secondary hover:bg-theme-ghost text-theme-secondary rounded-xl transition-colors border border-theme-primary",children:"Clear"}),e.jsx("button",{onClick:N,className:"h-12 flex items-center justify-center bg-theme-secondary hover:bg-theme-ghost text-theme-secondary rounded-xl transition-colors border border-theme-primary",children:e.jsx(Le,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"p-4 pt-0",children:e.jsx("button",{onClick:O,disabled:l===null||m||g,className:y("w-full py-4 rounded-xl font-bold text-lg transition-all",l!==null&&!m?"bg-emerald-500 hover:bg-emerald-400 active:bg-emerald-600 text-white shadow-lg shadow-emerald-500/30":"bg-theme-ghost text-theme-muted cursor-not-allowed"),children:m?"Saving...":"Log Temperature"})})]})}):null}const M=[];for(let s=0;s<256;++s)M.push((s+256).toString(16).slice(1));function tt(s,t=0){return(M[s[t+0]]+M[s[t+1]]+M[s[t+2]]+M[s[t+3]]+"-"+M[s[t+4]]+M[s[t+5]]+"-"+M[s[t+6]]+M[s[t+7]]+"-"+M[s[t+8]]+M[s[t+9]]+"-"+M[s[t+10]]+M[s[t+11]]+M[s[t+12]]+M[s[t+13]]+M[s[t+14]]+M[s[t+15]]).toLowerCase()}let X;const st=new Uint8Array(16);function rt(){if(!X){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");X=crypto.getRandomValues.bind(crypto)}return X(st)}const at=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),le={randomUUID:at};function nt(s,t,r){s=s||{};const a=s.random??s.rng?.()??rt();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,tt(a)}function te(s,t,r){return le.randomUUID&&!s?le.randomUUID():nt(s)}function it(s,t,r,a){const o=new Date,n=new Date(o.getTime()+ae.SOFT_LIMIT_MINUTES*60*1e3),d=new Date(o.getTime()+ae.HARD_LIMIT_MINUTES*60*1e3);return{id:te(),item_name:s,item_category:t,started_at:o.toISOString(),soft_due_at:n.toISOString(),hard_due_at:d.toISOString(),status:"active",site_id:r,created_by:a,synced:!1}}function B(s,t,r,a={}){return{id:te(),session_id:s,site_id:t,event_type:r,timestamp:new Date().toISOString(),payload:a,synced:!1}}function ce(s,t,r){const a=t==="warning"?`‚ö†Ô∏è ${r} cooling for 90 minutes - check soon!`:`üö® ${r} OVERDUE - action required NOW!`;return{id:te(),session_id:s,type:t,message:a,triggered_at:new Date().toISOString(),acknowledged:!1}}async function K(s){if(!de())return console.log("Supabase not configured, skipping sync"),!1;try{const{error:t}=await me.from("cooling_sessions").upsert({id:s.id,site_id:s.site_id,item_name:s.item_name,item_category:s.item_category,started_at:s.started_at,soft_due_at:s.soft_due_at,hard_due_at:s.hard_due_at,closed_at:s.closed_at,status:s.status,close_action:s.close_action,start_temperature:s.start_temperature,end_temperature:s.end_temperature,started_by_id:s.started_by_id,staff_name:s.staff_name,closed_by:s.closed_by,closed_by_id:s.closed_by_id,food_item_id:s.food_item_id,exception_reason:s.exception_reason,exception_approved_by:s.exception_approved_by,created_by:s.created_by});if(t)throw t;return!0}catch(t){return console.error("Failed to sync session to Supabase:",t),!1}}async function W(s){if(!de())return console.log("Supabase not configured, skipping sync"),!1;try{const{error:t}=await me.from("cooling_events").insert({id:s.id,session_id:s.session_id,site_id:s.site_id,event_type:s.event_type,timestamp:s.timestamp,payload:s.payload});if(t)throw t;return!0}catch(t){return console.error("Failed to sync event to Supabase:",t),!1}}function ot(){const{coolingSessions:s,addCoolingSession:t,updateCoolingSession:r,addAlert:a,addToOfflineQueue:o,currentSite:n,isOnline:d}=L();return{startCooling:async(m,p="other")=>{if(!n)return console.error("No site selected"),null;const g=it(m,p,n.id);t(g);const b=B(g.id,n.id,"started",{item_name:m,item_category:p});return d?await K(g)&&(r(g.id,{synced:!0}),await W(b)):o(b),g},closeCooling:async(m,p)=>{const g=s.find(_=>_.id===m);if(!g||!n)return!1;const b=new Date().toISOString(),C=re(new Date(g.started_at)),w=C==="overdue"?"overdue":"closed",i=Math.floor((Date.now()-new Date(g.started_at).getTime())/(1e3*60)),l={closed_at:b,status:w,close_action:"in_fridge",end_temperature:p?.temperature,closed_by_id:p?.staffId,closed_by:p?.staffName};r(m,l);const f=B(m,n.id,"closed",{close_action:"in_fridge",was_overdue:C==="overdue",elapsed_minutes:i,end_temperature:p?.temperature,closed_by:p?.staffName,temperature_compliant:p?.temperature!==void 0?p.temperature<8:void 0});return d?await K({...g,...l})&&(r(m,{synced:!0}),await W(f)):o(f),!0},discardCooling:async(m,p)=>{const g=s.find(i=>i.id===m);if(!g||!n)return!1;const C={closed_at:new Date().toISOString(),status:"discarded",close_action:"discarded",exception_reason:p};r(m,C);const w=B(m,n.id,"discarded",{reason:p,elapsed_minutes:Math.floor((Date.now()-new Date(g.started_at).getTime())/(1e3*60))});return d?await K({...g,...C})&&(r(m,{synced:!0}),await W(w)):o(w),!0},addException:async(m,p,g)=>{const b=s.find(l=>l.id===m);if(!b||!n)return!1;const w={closed_at:new Date().toISOString(),status:"closed",close_action:"exception",exception_reason:p,exception_approved_by:g};r(m,w);const i=B(m,n.id,"exception_added",{reason:p,approved_by:g,elapsed_minutes:Math.floor((Date.now()-new Date(b.started_at).getTime())/(1e3*60))});return d?await K({...b,...w})&&(r(m,{synced:!0}),await W(i)):o(i),!0},updateSessionStatuses:()=>{s.forEach(m=>{if(m.closed_at)return;const p=re(new Date(m.started_at));p!==m.status&&(r(m.id,{status:p}),p==="warning"&&m.status==="active"?a(ce(m.id,"warning",m.item_name)):p==="overdue"&&m.status!=="overdue"&&a(ce(m.id,"overdue",m.item_name)))})},coolingSessions:s}}function bt({onNavigate:s,currentScreen:t="home"}){const[r,a]=c.useState(!1),[o,n]=c.useState(null),[d,h]=c.useState(!1),{coolingSessions:j,currentSite:u,alerts:v,acknowledgeAlert:S}=L(),{startCooling:m,closeCooling:p,discardCooling:g,updateSessionStatuses:b}=ot(),{speak:C}=xe(),w=c.useMemo(()=>we(j),[j]),i=c.useMemo(()=>Ne(j),[j]),l=c.useMemo(()=>Ce(v),[v]),f=c.useMemo(()=>j.find(x=>x.id===o)||null,[j,o]);c.useEffect(()=>{const x=setInterval(b,1e4);return()=>clearInterval(x)},[b]);const _=c.useMemo(()=>i.length>0?"critical":w.some(x=>x.status==="warning")?"warning":"ready",[w,i]),I=c.useCallback(async(x,F)=>{await m(x,F)&&C(`Cooling started for ${x}`)},[m,C]),N=c.useCallback(x=>{n(x)},[]),k=c.useCallback(async x=>{if(!o)return;if(await p(o,x)){const se=x.temperature!==void 0?` at ${x.temperature}¬∞C`:"";C(`Item moved to fridge${se}. Well done!`),n(null)}},[o,p,C]),O=c.useCallback(async x=>{await g(x)&&C("Item discarded and logged")},[g,C]),A=c.useCallback(x=>{switch(x.type){case"start_cooling":x.item?I(x.item,"other"):a(!0);break;case"stop_cooling":w.length>0&&N(w[0].id);break;case"discard":w.length>0&&O(w[0].id);break}},[w,I,N,O]),R=c.useCallback(x=>{s?.(x)},[s]),T=c.useCallback(()=>{if(l.length===0){$.info("No new notifications");return}l.forEach((x,F)=>{setTimeout(()=>{x.type==="overdue"?$.error(x.message,{duration:5e3}):$.warning(x.message,{duration:5e3}),S(x.id)},F*500)})},[l,S]);return e.jsxs("div",{className:"min-h-screen bg-theme-primary flex",children:[e.jsx(Se,{currentScreen:t,onNavigate:R,siteName:u?.name||"Kitchen Ops"}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[e.jsx(Be,{complianceStatus:_,lastAudit:"Today",autoLogging:!0,notificationCount:l.length,onNotificationsClick:T}),e.jsxs("main",{className:"flex-1 p-4 lg:p-6 pb-24 lg:pb-6 overflow-auto",children:[e.jsx("section",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-3 px-6 py-4 bg-gradient-to-r from-cyan-500/20 to-sky-500/20 border-2 border-cyan-500/50 rounded-2xl hover:border-cyan-400 hover:from-cyan-500/30 hover:to-sky-500/30 transition-all group",children:[e.jsx("div",{className:"p-3 rounded-xl bg-cyan-500/20 text-cyan-500 group-hover:bg-cyan-500/30 transition-colors",children:e.jsx(H,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"font-bold text-theme-primary text-lg",children:"Log Fridge Temp"}),e.jsx("p",{className:"text-xs text-theme-muted",children:"FSAI SC1 Compliance"})]})]}),e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-3 px-6 py-4 bg-gradient-to-r from-sky-500/20 to-blue-500/20 border-2 border-sky-500/50 rounded-2xl hover:border-sky-400 hover:from-sky-500/30 hover:to-blue-500/30 transition-all group",children:[e.jsx("div",{className:"p-3 rounded-xl bg-sky-500/20 text-sky-500 group-hover:bg-sky-500/30 transition-colors",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"font-bold text-theme-primary text-lg",children:"Start Cooling"}),e.jsx("p",{className:"text-xs text-theme-muted",children:"Track hot food"})]})]})]})}),e.jsxs("section",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-emerald-500",children:"‚úì"}),e.jsx("h2",{className:"text-sm font-semibold text-theme-secondary uppercase tracking-wide",children:"Daily Compliance Cycles"})]}),e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide",children:[e.jsx(Q,{title:"Cooling Records",value:w.length>0?65:100,status:w.length>0?"in-progress":"complete",subtitle:w.length>0?`${w.length} active`:"All complete"}),e.jsx(Q,{title:"Mid-Day Logs",value:65,status:"in-progress",subtitle:"Next: 15:00 Probe Test"}),e.jsx(Q,{title:"Closing Routine",value:"Pending",status:"pending",subtitle:"Starts at 22:30 PM"})]})]}),i.length>0&&e.jsxs("section",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-red-500"}),e.jsx("h2",{className:"text-sm font-semibold text-red-600 uppercase tracking-wide",children:"Critical Actions"}),e.jsxs("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs font-bold rounded-full",children:[i.length," ALERT",i.length>1?"S":""]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:i.map(x=>e.jsx(oe,{session:x,onClose:N,onDiscard:O},x.id))})]}),e.jsxs("section",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-sky-500"}),e.jsx("h2",{className:"text-sm font-semibold text-theme-secondary uppercase tracking-wide",children:"Active Cooling Monitors"}),w.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-sky-100 text-sky-700 text-xs font-bold rounded-full",children:w.filter(x=>x.status!=="overdue").length})]}),e.jsxs("button",{className:"text-sm text-sky-600 font-medium hover:underline flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),"View All"]})]}),w.filter(x=>x.status!=="overdue").length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:w.filter(x=>x.status!=="overdue").map(x=>e.jsx(oe,{session:x,onClose:N,onDiscard:O},x.id))}):e.jsxs("div",{className:"bg-theme-card rounded-2xl border border-theme-primary p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-theme-secondary flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{className:"w-8 h-8 text-theme-muted"})}),e.jsx("h3",{className:"text-lg font-semibold text-theme-primary mb-2",children:"No Active Cooling"}),e.jsx("p",{className:"text-theme-secondary mb-6 max-w-sm mx-auto",children:"All items have been processed. Start a new cooling session when needed."}),e.jsxs("button",{onClick:()=>a(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-sky-500 text-white rounded-xl font-semibold hover:bg-sky-600 transition-colors",children:[e.jsx(q,{className:"w-5 h-5"}),"Start Cooling"]})]})]}),e.jsxs("section",{className:"bg-theme-card rounded-2xl border border-theme-primary p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(G,{className:"w-5 h-5 text-purple-500"}),e.jsx("h2",{className:"text-sm font-semibold text-theme-secondary uppercase tracking-wide",children:"Voice Commands"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6",children:[e.jsx(Qe,{onCommand:A,size:"md"}),e.jsxs("div",{className:"text-sm text-theme-secondary space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-purple-500",children:'"Start cooling [item]"'})," - Begin tracking"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-emerald-500",children:'"Done"'})," or ",e.jsx("span",{className:"font-medium text-emerald-500",children:'"In fridge"'})," - Complete session"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-red-500",children:'"Discard"'})," - Log waste"]})]})]})]})]}),e.jsx("button",{onClick:()=>a(!0),className:"lg:hidden fixed right-4 bottom-20 w-14 h-14 rounded-full bg-sky-500 text-white shadow-lg shadow-sky-500/30 flex items-center justify-center hover:bg-sky-600 transition-all active:scale-95 z-40",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsx(_e,{currentScreen:t,onNavigate:R}),e.jsx(Ye,{isOpen:r,onClose:()=>a(!1),onStart:I}),e.jsx(Je,{isOpen:o!==null,onClose:()=>n(null),onConfirm:k,session:f}),e.jsx(et,{isOpen:d,onClose:()=>h(!1)})]})}export{bt as Dashboard};
